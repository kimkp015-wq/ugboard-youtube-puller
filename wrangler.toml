export interface Env {
  U_INTERNAL_TOKEN: string
}

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    if (request.method !== "POST") {
      return new Response("Use POST", { status: 405 })
    }

    const res = await fetch(
      "https://<YOUR-RAILWAY-URL>/api/ingestion/youtube",
      {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${env.U_INTERNAL_TOKEN}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          trigger: "manual-fire",
          source: "cloudflare-worker"
        })
      }
    )

    return new Response(
      JSON.stringify({
        fired: true,
        engine_status: res.status
      }),
      {
        headers: { "Content-Type": "application/json" }
      }
    )
  }
}
